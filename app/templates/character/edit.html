{% extends "layout.html" %}
{% block body %}
<h2 class="icon fa-pencil">Character</h2>

<form action="{{ url_for('character.edit', character_id=character.id) }}" method="post">
    <button name="button" value="save" class="hidden">Hidden</button>

<div id="edit-character">

    <div id="description" class="nice-panel brand">
        <div class="nice-panel-heading">
            Description
        </div>
        <div class="nice-panel-content">

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Name
                </span>
                <input type="text" class="nice-form-control" name="character.name" value="{{ character.name }}" />
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Height
                </span>
                <input type="text" class="nice-form-control" name="character.height" value="{{ character.height }}" />
                <span class="nice-input-addon">
                    ft.
                </span>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Weight
                </span>
                <input type="text" class="nice-form-control" name="character.weight" value="{{ character.weight }}" />
                <span class="nice-input-addon">
                    lb.
                </span>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Age
                </span>
                <input type="text" class="nice-form-control" name="character.age" value="{{ character.age }}" />
                <span class="nice-input-addon">
                    years old
                </span>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Appearance
                </span>
                <textarea class="nice-form-control" name="character.personality.appearance" rows="5">{{ character.personality.appearance }}</textarea>
            </div>

        </div>
    </div>

    <div id="personality" class="nice-panel brand">
        <div class="nice-panel-heading">
            Personality
        </div>
        <div class="nice-panel-content">

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Alignment
                </span>
                <select class="nice-form-control" name="character.alignment">
                    {%- for group, options in {'good': ['lawful good', 'neutral good', 'chaotic good'], 'neutral': ['lawful neutral', 'true neutral', 'chaotic neutral'], 'evil': ['lawful evil', 'neutral evil', 'chaotic evil']}.items() %}
                    <optgroup label="{{ group|capitalize }}">
                        {%- for option in options %}
                        <option{{ {
                                "selected": "selected" if character.alignment == option else None,
                                "value": option
                            }|xmlattr }}>{{ option|capitalize }}</option>
                        {%- endfor %}
                    </optgroup>
                    {%- endfor %}
                </select>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Traits
                </span>
                <textarea class="nice-form-control" name="character.personality.traits" rows="2">{{ character.personality.traits }}</textarea>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Ideals
                </span>
                <textarea class="nice-form-control" name="character.personality.ideals" rows="2">{{ character.personality.ideals }}</textarea>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Bonds
                </span>
                <textarea class="nice-form-control" name="character.personality.bonds" rows="2">{{ character.personality.bonds }}</textarea>
            </div>

            <div class="nice-control-group">
                <span class="nice-input-addon">
                    Flaws
                </span>
                <textarea class="nice-form-control" name="character.personality.flaws" rows="2">{{ character.personality.flaws }}</textarea>
            </div>

        </div>
    </div>

    <div id="background" class="nice-panel brand">
        <div class="nice-panel-heading">
            Backstory
        </div>
        <div class="nice-panel-content">

            <textarea class="nice-form-control" name="character.personality.backstory" rows="15">{{ character.personality.backstory }}</textarea>

        </div>
    </div>

    <div id="spells" class="nice-panel brand">
        <div class="nice-panel-heading">
            Spells
        </div>
        <div class="nice-panel-content">
            <ul>
                <li>
                    <strong>Cantrip</strong>
                    <ul>
                        {% for i in range([character.cantrips_known, character.spells.cantrip|length]|max) %}
                        <li>
                            {% if character.spells.cantrip[i] -%}
                                <span class="nice-form-control">{{ character.spells.cantrip[i] }}</span>
                            {%- else -%}

<select{{ {
        "class": "nice-form-control",
        "name": ['character', 'spells', 'cantrip', i]|join('.')
        }|xmlattr }}>
    {% for option in items.spells[character.class|lower]['cantrip'] %}
        <option{{ {
                "selected": "selected" if character.spells.cantrip[i] == option.name else None,
                "value": option.name
                }|xmlattr }}>
            {{ option.label|default(option.name|capitalize) }}
        </option>
    {% endfor %}
</select>

                            {%- endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </li>
                {%- for level, spells in character.spells.items()|sort() %}
                {%- if level != 'cantrip' and character.spell_slots[level] -%}
                <li>
                    <strong>{{ level|field_title }}</strong>
                    <ul>
                        {% for i in range([character.spell_slots[level], spells|length]|max) %}
                        <li>
                            {% if spells[i] -%}
                                <span class="nice-form-control">{{ spells[i] }}</span>
                            {%- else -%}

<select{{ {
        "class": "nice-form-control",
        "name": ['character', 'spells', level, i]|join('.')
        }|xmlattr }}>
    {% for option in items.spells[character.class|lower][level] %}
        <option{{ {
                "selected": "selected" if spells[i] == option.name else None,
                "value": option.name
                }|xmlattr }}>
            {{ option.label|default(option.name|capitalize) }}
        </option>
    {% endfor %}
</select>
                            {%- endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </li>
                {%- endif %}
                {%- endfor %}
            </ul>
        </div>
    </div>

    <div id="save">
        <button name="button" value="cancel" class="nice-btn muted icon fa-ban">Cancel</button>
        <button name="button" value="update" class="nice-btn info icon fa-refresh">Update</button>
        <button name="button" value="save" class="nice-btn primary icon fa-save">Save</button>
    </div>
</div>

</form>
{% endblock %}
